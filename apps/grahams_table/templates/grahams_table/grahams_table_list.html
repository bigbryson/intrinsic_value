{% extends "layout/layout_vertical.html" %}
{% load static i18n %}
{% load grahams_table_extras %} {# Load our new custom filter #}

{% block title %}Graham's Table{% endblock %}

{% block content %}
<div class="card">
  <h5 class="card-header">Graham's Intrinsic Value Table</h5>
  <div class="table-responsive text-nowrap">
    <table class="table table-hover">
      <thead>
        <tr>
          {% for header in table_headers %}
            <th>{{ header }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody class="table-border-bottom-0">
        {% for stock_item in stocks_list %}
          <tr>
            {# This loop now uses our new get_item filter #}
            {% for header_key in table_headers %}
              <td>
                {% if header_key == "Symbol" %}
                  {# Corrected url tag syntax #}
                  <a href="{% url 'grahams_table:stock_detail' stock_item.Symbol %}">
                    <strong>{{ stock_item|get_item:header_key }}</strong>
                  </a>
                {% else %}
                  {{ stock_item|get_item:header_key|default_if_none:"N/A" }}
                {% endif %}
              </td>
            {% endfor %}
          </tr>
        {% empty %}
          <tr><td colspan="{{ table_headers|length }}" class="text-center py-5">{% translate "No stocks to display." %}</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock content %}
